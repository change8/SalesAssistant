<!-- æœªç™»å½•æç¤º -->
<view wx:if="{{!isLoggedIn}}" class="login-prompt">
  <view class="prompt-icon">ğŸ“‹</view>
  <view class="prompt-title">ä»»åŠ¡æ¸…å•åŠŸèƒ½</view>
  <view class="prompt-desc">æ³¨å†Œåå¯ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡æ¸…å•åŠŸèƒ½</view>
  <view class="prompt-desc">æäº¤ä»»åŠ¡åæ— éœ€ç­‰å¾…ï¼Œå¯é€€å‡ºå°ç¨‹åºç¨åæŸ¥çœ‹</view>
  <view class="prompt-actions">
    <button class="btn-primary" bindtap="onGoRegister">ç«‹å³æ³¨å†Œ</button>
    <button class="btn-secondary" bindtap="onGoLogin">å·²æœ‰è´¦å·ï¼Œå»ç™»å½•</button>
  </view>
</view>

<!-- å·²ç™»å½•å†…å®¹ -->
<view wx:else>
  <view class="task-header">
    <view class="mode-switch">
      <view class="mode-item {{viewMode==='active'?'active':''}}" data-mode="active" bindtap="onSwitchMode">è¿›è¡Œä¸­</view>
      <view class="mode-item {{viewMode==='history'?'active':''}}" data-mode="history" bindtap="onSwitchMode">å†å²ä»»åŠ¡</view>
    </view>
    <button class="refresh-btn" size="mini" bindtap="onRefresh" loading="{{loading}}">åˆ·æ–°</button>
  </view>

  <view class="task-list">
  <block wx:if="{{viewMode==='active'}}">
    <block wx:if="{{activeList.length}}">
      <block wx:for="{{activeList}}" wx:key="id">
        <view class="task-item" bindtap="onTapTask" data-id="{{item.id}}">
          <view class="task-title">{{item.task_type_label}} Â· #{{item.id}}</view>
          <view class="task-meta">çŠ¶æ€ï¼š{{item.status}}</view>
          <view class="task-meta">åˆ›å»ºæ—¶é—´ï¼š{{item.created_at}}</view>
          <view wx:if="{{item.description}}" class="task-desc">{{item.description}}</view>
        </view>
      </block>
    </block>
    <block wx:else>
      <view class="empty">å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„ä»»åŠ¡</view>
    </block>
  </block>

  <block wx:elif="{{viewMode==='history'}}">
    <block wx:if="{{historyList.length}}">
      <block wx:for="{{historyList}}" wx:key="id">
        <view class="task-item" bindtap="onTapTask" data-id="{{item.id}}">
          <view class="task-title">{{item.task_type_label}} Â· #{{item.id}}</view>
          <view class="task-meta">çŠ¶æ€ï¼š{{item.status}}</view>
          <view class="task-meta">å®Œæˆæ—¶é—´ï¼š{{item.finished_at || 'â€”'}}</view>
          <view wx:if="{{item.error_message}}" class="task-error">é”™è¯¯ï¼š{{item.error_message}}</view>
        </view>
      </block>
    </block>
    <block wx:else>
      <view class="empty">æš‚æ— å†å²ä»»åŠ¡</view>
    </block>
  </block>
  </view>
</view>
