<view class="task-header">
  <view class="mode-switch">
    <view class="mode-item {{viewMode==='active'?'active':''}}" data-mode="active" bindtap="onSwitchMode">进行中</view>
    <view class="mode-item {{viewMode==='history'?'active':''}}" data-mode="history" bindtap="onSwitchMode">历史任务</view>
  </view>
  <button class="refresh-btn" size="mini" bindtap="onRefresh" loading="{{loading}}">刷新</button>
</view>

<view class="task-list">
  <block wx:if="{{viewMode==='active'}}">
    <block wx:if="{{activeList.length}}">
      <block wx:for="{{activeList}}" wx:key="id">
        <view class="task-item" bindtap="onTapTask" data-id="{{item.id}}">
          <view class="task-title">{{item.task_type_label}} · #{{item.id}}</view>
          <view class="task-meta">状态：{{item.status}}</view>
          <view class="task-meta">创建时间：{{item.created_at}}</view>
          <view wx:if="{{item.description}}" class="task-desc">{{item.description}}</view>
        </view>
      </block>
    </block>
    <block wx:else>
      <view class="empty">当前没有进行中的任务</view>
    </block>
  </block>

  <block wx:elif="{{viewMode==='history'}}">
    <block wx:if="{{historyList.length}}">
      <block wx:for="{{historyList}}" wx:key="id">
        <view class="task-item" bindtap="onTapTask" data-id="{{item.id}}">
          <view class="task-title">{{item.task_type_label}} · #{{item.id}}</view>
          <view class="task-meta">状态：{{item.status}}</view>
          <view class="task-meta">完成时间：{{item.finished_at || '—'}}</view>
          <view wx:if="{{item.error_message}}" class="task-error">错误：{{item.error_message}}</view>
        </view>
      </block>
    </block>
    <block wx:else>
      <view class="empty">暂无历史任务</view>
    </block>
  </block>
</view>
