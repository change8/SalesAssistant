<view class="container">
  <view class="sticky-header">
    <!-- Tabs -->
    <view class="tabs">
      <view 
        wx:for="{{tabs}}" 
        wx:key="index"
        class="tab-item {{activeTab === index ? 'active' : ''}}"
        data-index="{{index}}"
        bindtap="switchTab"
      >
        {{item}}
      </view>
    </view>

    <!-- Search Bar -->
    <view class="search-bar">
      <input 
        class="search-input" 
        placeholder="{{placeholderText}}"
        value="{{searchQuery}}"
        bindinput="onSearchInput"
        bindconfirm="performSearch"
        confirm-type="search"
      />
      <view wx:if="{{searchQuery}}" class="clear-btn" bindtap="onClearSearch">
        <icon type="clear" size="14" color="#d1d5db"/>
      </view>
      <view class="filter-btn" bindtap="openFilter">
        <image wx:if="{{hasActiveFilters}}" src="../../assets/filter_active.png" class="filter-icon-img" mode="aspectFit"></image>
        <image wx:else src="../../assets/filter_gray.png" class="filter-icon-img" mode="aspectFit"></image>
      </view>
    </view>

    <!-- Quick Tags -->
    <scroll-view scroll-x class="quick-tags" enable-flex>
      <!-- Contract Tags -->
      <block wx:if="{{activeTab === 0}}">
        <view class="chip {{quickTags.fp ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="fp">åªçœ‹ FP</view>
        <view class="chip {{quickTags.time === '3' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="time" data-value="3">è¿‘ 3 å¹´</view>
        <view class="chip {{quickTags.time === '5' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="time" data-value="5">è¿‘ 5 å¹´</view>
        <view class="chip {{quickTags.amount === '300' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="amount" data-value="300">300ä¸‡+</view>
        <view class="chip {{quickTags.amount === '500' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="amount" data-value="500">500ä¸‡+</view>
        <view class="chip {{quickTags.amount === '1000' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="amount" data-value="1000">1000ä¸‡+</view>
      </block>

      <!-- Qualification Tags -->
      <block wx:if="{{activeTab === 1}}">
        <view class="chip {{quickTags.group === '1100' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="group" data-value="1100">åªçœ‹é›†å›¢</view>
        <view class="chip {{quickTags.notExpired ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="notExpired">æœªè¿‡æœŸ</view>
      </block>

      <!-- IP Tags -->
      <block wx:if="{{activeTab === 2}}">
         <view class="chip {{quickTags.group === '1100' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="group" data-value="1100">åªçœ‹é›†å›¢</view>
        <view class="chip {{quickTags.notExpired ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="notExpired">æœªè¿‡æœŸ</view>
        <view class="chip {{quickTags.ipCategory === 'patent' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="ipCategory" data-value="patent">ä¸“åˆ©</view>
        <view class="chip {{quickTags.ipCategory === 'copyright' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="ipCategory" data-value="copyright">è½¯è‘—</view>
        <view class="chip {{quickTags.ipCategory === 'trademark' ? 'active' : ''}}" bindtap="toggleQuickTag" data-type="ipCategory" data-value="trademark">å•†æ ‡</view>
      </block>
    </scroll-view>
  </view>

  <!-- Results -->
  <view class="results">
    <!-- Loading -->
    <view wx:if="{{loading && results.length === 0}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- Empty -->
    <view wx:elif="{{!loading && results.length === 0}}" class="empty">
      <text class="icon">ğŸ”</text>
      <text class="message">{{searchQuery ? 'æœªæ‰¾åˆ°ç›¸å…³ç»“æœ' : 'è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢'}}</text>
      
      <!-- Helper Text -->
      <view class="search-helper" wx:if="{{!searchQuery}}">
        <text wx:if="{{activeTab === 0}}">å¯ç­›é€‰ 2015--2025 åå¹´å†…æ‰€æœ‰åˆåŒ</text>
        <text wx:elif="{{activeTab === 1}}">å¯ç­›é€‰æ‰€æœ‰èµ„è´¨</text>
        <text wx:elif="{{activeTab === 2}}">å¯ç­›é€‰æ‰€æœ‰çŸ¥è¯†äº§æƒ</text>
        <text wx:elif="{{activeTab === 3}}">ä»…æœ‰å°éƒ¨åˆ†äººå‘˜ä¿¡æ¯ï¼Œè‹¥æœç´¢ä¸åˆ°ç›¸å…³è¯ä¹¦ï¼Œè¯·è”ç³»æŠ•æ ‡ç®¡ç†éƒ¨â€œé™ˆæ™¨ã€å¼ å¦â€è¿›è¡ŒæŸ¥è¯¢</text>
      </view>
    </view>

    <!-- Contract Results -->
    <block wx:if="{{activeTab === 0}}">
      <view wx:for="{{results}}" wx:key="id" class="card" bindtap="showContractDetail" data-item="{{item}}">
        <view class="card-header">
          <view class="title-row">
            <text wx:if="{{item.short_type}}" class="tag-mini">{{item.short_type}}</text>
            <text class="title">{{item.contract_title || item.project_name || 'æœªå‘½ååˆåŒ'}}</text>
          </view>
          <view class="copy-btn" catchtap="copyItem" data-item="{{item}}">å¤åˆ¶</view>
        </view>
        <view class="card-body">
          <view class="info">
            <view class="info-row">
              <text class="info-label">ğŸ¢ å®¢æˆ·:</text>
              <text class="info-value">{{item.display_customer}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">ğŸ’° é‡‘é¢:</text>
              <text class="info-value amount-text">{{item.contract_amount || '-'}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">ğŸ“… ç­¾è®¢:</text>
              <text class="info-value">{{item.signing_date || '-'}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- Contract Detail Popup -->
    <view class="detail-popup {{showDetail ? 'open' : ''}}" wx:if="{{activeTab === 0}}">
      <view class="detail-mask" bindtap="closeContractDetail"></view>
      <view class="detail-content">
        <view class="detail-header">
          <text>åˆåŒè¯¦æƒ…</text>
          <view class="close-btn" bindtap="closeContractDetail">Ã—</view>
        </view>
        <scroll-view scroll-y class="detail-body">
          <view class="detail-title">{{selectedContract.contract_title || selectedContract.project_name}}</view>
          
          <view class="detail-tags">
            <text class="tag tag-primary">{{selectedContract.contract_number || 'æ— ç¼–å·'}}</text>
            <text wx:if="{{selectedContract.project_code}}" class="tag tag-primary">{{selectedContract.project_code}}</text>
            <text wx:if="{{selectedContract.contract_status}}" class="tag tag-success">{{selectedContract.contract_status}}</text>
            <text wx:if="{{selectedContract.contract_type}}" class="tag tag-secondary">{{selectedContract.contract_type}}</text>
          </view>

          <view class="detail-section">
            <view class="detail-row" wx:if="{{selectedContract.project_code}}">
              <text class="label">ğŸ”¢ é¡¹ç›®ç¼–å·</text>
              <text class="value">{{selectedContract.project_code}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ğŸ¢ å®¢æˆ·åç§°</text>
              <text class="value">{{selectedContract.display_customer || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ğŸ­ æ‰€å±è¡Œä¸š</text>
              <text class="value">{{selectedContract.display_industry || '-'}}</text>
            </view>
            <view class="detail-row" wx:if="{{selectedContract.delivery_location}}">
              <text class="label">ğŸ“ äº¤ä»˜åœ°ç‚¹</text>
              <text class="value">{{selectedContract.delivery_location}}</text>
            </view>
            <view class="detail-row" wx:if="{{selectedContract.delivery_team}}">
              <text class="label">ğŸ‘¥ äº¤ä»˜å›¢é˜Ÿ</text>
              <text class="value">{{selectedContract.delivery_team}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ğŸ“… ç­¾è®¢æ—¶é—´</text>
              <text class="value">{{selectedContract.signing_date || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ğŸ’° åˆåŒé‡‘é¢</text>
              <text class="value highlight">{{selectedContract.contract_amount || '-'}}</text>
            </view>
             <view class="detail-row">
              <text class="label">ğŸ“Š åˆåŒçŠ¶æ€</text>
              <text class="value">{{selectedContract.contract_status || '-'}}</text>
            </view>
          </view>

          <view class="detail-section">
            <view class="section-title">ç®€ä»‹</view>
            <view class="description">{{selectedContract.description || 'æ— ç®€ä»‹'}}</view>
          </view>
        </scroll-view>
        <view class="detail-footer">
          <button class="copy-full-btn" bindtap="copyItem" data-item="{{selectedContract}}">å¤åˆ¶åˆåŒä¿¡æ¯</button>
        </view>
      </view>
    </view>

    <!-- Qualification Results -->
    <block wx:if="{{activeTab === 1}}">
      <view wx:for="{{results}}" wx:key="id" class="card" bindtap="showQualDetail" data-item="{{item}}">
        <view class="card-header">{{item.qualification_name || 'æœªå‘½åèµ„è´¨'}}</view>
        <view class="card-body">
          <view class="tags">
            <text wx:if="{{item.company_name}}" class="tag tag-primary">{{item.company_name}}</text>
            <text wx:if="{{item.company_code}}" class="tag tag-secondary">{{item.company_code}}</text>
            <text wx:if="{{!item.company_code}}" class="tag tag-secondary">1100</text>
          </view>
          <view class="info">
            <view class="info-row">
              <text class="info-label">è¯ä¹¦ç­‰çº§:</text>
              <text class="info-value">{{item.qualification_level || '-'}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">åˆ°æœŸæ—¶é—´:</text>
              <text class="info-value highlight">{{item.expire_date || item.expire_date_str || '-'}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- IP Results -->
    <block wx:if="{{activeTab === 2}}">
      <view wx:for="{{results}}" wx:key="id" class="card" bindtap="showIPDetail" data-item="{{item}}">
        <view class="card-header">{{item.qualification_name || 'æœªå‘½åçŸ¥äº§'}}</view>
        <view class="card-body">
           <view class="tags">
            <text wx:if="{{item.company_name}}" class="tag tag-primary">{{item.company_name}}</text>
             <text wx:if="{{item.business_type}}" class="tag tag-success">{{item.business_type}}</text>
             <text wx:if="{{item.company_code}}" class="tag tag-secondary">{{item.company_code}}</text>
          </view>
          <view class="info">
             <view class="info-row">
              <text class="info-label">è¯ä¹¦ç¼–å·:</text>
              <text class="info-value">{{item.certificate_number || '-'}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- Personnel Results -->
    <block wx:if="{{activeTab === 3}}">
      <view wx:for="{{results}}" wx:key="id" class="card" bindtap="showPersonnelDetail" data-item="{{item}}">
        <view class="card-header">
           <text>{{item.name}}</text>
           <text class="tag-mini" style="margin-left: 12rpx;">{{item.employee_no}}</text>
        </view>
        <view class="card-body">
           <view class="info-row">
             <text class="info-label">æ‰€å±å…¬å¸:</text>
             <text class="info-value">{{item.company || '-'}}</text>
           </view>
           <view wx:if="{{item.certificates && item.certificates.length > 0}}" class="certificates">
            <text wx:for="{{item.certificates}}" wx:for-item="cert" wx:key="id" class="tag tag-warning">
              {{cert.certificate_name}}
            </text>
          </view>
        </view>
      </view>
    </block>

    <!-- Company Results -->
    <block wx:if="{{activeTab === 4}}">
      <view wx:for="{{results}}" wx:key="id" class="card" bindtap="showCompanyDetail" data-item="{{item}}">
        <view class="card-header">
           <view class="title-row">
            <text class="title">{{item.name || 'æœªå‘½åå…¬å¸'}}</text>
          </view>
          <view class="copy-btn" catchtap="copyItem" data-item="{{item}}">å¤åˆ¶</view>
        </view>
        <view class="card-body">
           <view class="tags">
            <text wx:if="{{item.code}}" class="tag tag-primary">{{item.code}}</text>
            <text wx:if="{{item.operating_state}}" class="tag tag-success">{{item.operating_state}}</text>
          </view>
          <view class="info">
            <view class="info-row" wx:if="{{item.nuccn}}">
              <text class="info-label">ç»Ÿä¸€ä¿¡ç”¨ä»£ç :</text>
              <text class="info-value">{{item.nuccn}}</text>
            </view>
             <view class="info-row" wx:if="{{item.legal_person}}">
              <text class="info-label">æ³•äºº:</text>
              <text class="info-value">{{item.legal_person}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- Company Detail Popup -->
    <view class="detail-popup {{showCompanyDetail ? 'open' : ''}}" wx:if="{{activeTab === 4}}">
      <view class="detail-mask" bindtap="closeCompanyDetail"></view>
      <view class="detail-content">
        <view class="detail-header">
          <text>å…¬å¸è¯¦æƒ…</text>
          <view class="close-btn" bindtap="closeCompanyDetail">Ã—</view>
        </view>
        <scroll-view scroll-y class="detail-body">
          <view class="detail-title">{{selectedCompany.name}}</view>
          
          <view class="detail-tags">
            <text wx:if="{{selectedCompany.code}}" class="tag tag-primary">{{selectedCompany.code}}</text>
            <text wx:if="{{selectedCompany.operating_state}}" class="tag tag-success">{{selectedCompany.operating_state}}</text>
          </view>

          <view class="detail-section">
             <view class="detail-row" wx:if="{{selectedCompany.nuccn}}">
              <text class="label">ç»Ÿä¸€ä¿¡ç”¨ä»£ç </text>
              <text class="value">{{selectedCompany.nuccn}}</text>
            </view>
            <view class="detail-row" wx:if="{{selectedCompany.legal_person}}">
              <text class="label">æ³•å®šä»£è¡¨äºº</text>
              <text class="value">{{selectedCompany.legal_person}}</text>
            </view>
            <view class="detail-row" wx:if="{{selectedCompany.registered_capital}}">
              <text class="label">æ³¨å†Œèµ„æœ¬</text>
              <text class="value">{{selectedCompany.registered_capital}} {{selectedCompany.currency || ''}}</text>
            </view>
             <view class="detail-row" wx:if="{{selectedCompany.setup_date}}">
              <text class="label">æˆç«‹æ—¥æœŸ</text>
              <text class="value">{{selectedCompany.setup_date}}</text>
            </view>
            <view class="detail-row" wx:if="{{selectedCompany.registered_address}}">
              <text class="label">æ³¨å†Œåœ°å€</text>
              <text class="value">{{selectedCompany.registered_address}}</text>
            </view>
             <view class="detail-row" wx:if="{{selectedCompany.operating_period}}">
              <text class="label">ç»è¥æœŸé™</text>
              <text class="value">{{selectedCompany.operating_period}}</text>
            </view>
            <view class="detail-row" wx:if="{{selectedCompany.company_type}}">
              <text class="label">å…¬å¸ç±»å‹</text>
              <text class="value">{{selectedCompany.company_type}}</text>
            </view>
          </view>

          <view class="detail-section">
            <view class="section-title">ç»è¥èŒƒå›´</view>
            <view class="description">{{selectedCompany.business_scope || 'æ— '}}</view>
          </view>
        </scroll-view>
        <view class="detail-footer">
          <button class="copy-full-btn" bindtap="copyCompanyFull" data-item="{{selectedCompany}}">å¤åˆ¶å…¨éƒ¨ä¿¡æ¯</button>
        </view>
      </view>
    </view>

    <!-- Qualification Detail Popup -->
    <view class="detail-popup {{showQualDetail ? 'open' : ''}}" wx:if="{{activeTab === 1}}">
      <view class="detail-mask" bindtap="closeQualDetail"></view>
      <view class="detail-content">
        <view class="detail-header">
          <text>èµ„è´¨è¯¦æƒ…</text>
          <view class="close-btn" bindtap="closeQualDetail">Ã—</view>
        </view>
        <scroll-view scroll-y class="detail-body">
          <view class="detail-title">{{selectedQual.qualification_name}}</view>
          
          <view class="detail-tags">
             <text wx:if="{{selectedQual.company_name}}" class="tag tag-primary">{{selectedQual.company_name}}</text>
             <text wx:if="{{selectedQual.company_code}}" class="tag tag-secondary">{{selectedQual.company_code}}</text>
             <text wx:if="{{selectedQual.qualification_level}}" class="tag tag-warning">{{selectedQual.qualification_level}}</text>
          </view>

          <view class="detail-section">
            <view class="detail-row">
              <text class="label">è¯ä¹¦ç¼–å·</text>
              <text class="value">{{selectedQual.certificate_number || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">å‘è¯æœºæ„</text>
              <text class="value">{{selectedQual.issue_organization || '-'}}</text>
            </view>
             <view class="detail-row">
              <text class="label">ä¸šåŠ¡ç±»å‹</text>
              <text class="value">{{selectedQual.qualification_type || selectedQual.business_type || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">åˆ°æœŸæ—¶é—´</text>
              <text class="value highlight">{{selectedQual.expire_date || selectedQual.expire_date_str || '-'}}</text>
            </view>
             <view class="detail-row">
              <text class="label">æ³¨å†Œå·</text>
              <text class="value">{{selectedQual.registration_no || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">å‘è¯æ—¥æœŸ</text>
              <text class="value">{{selectedQual.issue_date || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ä¸‹æ¬¡å¹´æ£€</text>
              <text class="value">{{selectedQual.next_review_date || '-'}}</text>
            </view>
             <view class="detail-row">
              <text class="label">å¤‡æ³¨</text>
              <text class="value">{{selectedQual.remark || '-'}}</text>
            </view>
          </view>
        </scroll-view>
        <view class="detail-footer">
          <button class="copy-full-btn" bindtap="copyQualFull" data-item="{{selectedQual}}">å¤åˆ¶å…¨éƒ¨ä¿¡æ¯</button>
        </view>
      </view>
    </view>

    <!-- IP Detail Popup -->
    <view class="detail-popup {{showIPDetail ? 'open' : ''}}" wx:if="{{activeTab === 2}}">
      <view class="detail-mask" bindtap="closeIPDetail"></view>
      <view class="detail-content">
        <view class="detail-header">
          <text>çŸ¥äº§è¯¦æƒ…</text>
          <view class="close-btn" bindtap="closeIPDetail">Ã—</view>
        </view>
        <scroll-view scroll-y class="detail-body">
          <view class="detail-title">{{selectedIP.qualification_name}}</view>
          
          <view class="detail-tags">
             <text wx:if="{{selectedIP.company_name}}" class="tag tag-primary">{{selectedIP.company_name}}</text>
             <text wx:if="{{selectedIP.business_type}}" class="tag tag-secondary">{{selectedIP.business_type}}</text>
          </view>

          <view class="detail-section">
            <view class="detail-row">
              <text class="label">è¯ä¹¦ç¼–å·</text>
              <text class="value">{{selectedIP.certificate_number || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">æ³¨å†Œå·</text>
              <text class="value">{{selectedIP.registration_no || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ç”³è¯·å·</text>
              <text class="value">{{selectedIP.internal_id || '-'}}</text>
            </view>
             <view class="detail-row">
              <text class="label">å‘æ˜äºº</text>
              <text class="value">{{selectedIP.inventor || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ç”³è¯·æ—¥æœŸ</text>
              <text class="value">{{selectedIP.application_date || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">æˆæƒå…¬å‘Šæ—¥</text>
              <text class="value">{{selectedIP.issue_date || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">çŸ¥è¯†äº§æƒç±»åˆ«</text>
              <text class="value">{{selectedIP.knowledge_category || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ä¸“åˆ©ç±»åˆ«</text>
              <text class="value">{{selectedIP.patent_category || '-'}}</text>
            </view>
          </view>

          <view class="detail-section">
             <view class="section-title">æ‘˜è¦</view>
             <view class="description">{{selectedIP.property_summary || 'æ— '}}</view>
          </view>
        </scroll-view>
        <view class="detail-footer">
          <button class="copy-full-btn" bindtap="copyIPFull" data-item="{{selectedIP}}">å¤åˆ¶å…¨éƒ¨ä¿¡æ¯</button>
        </view>
      </view>
    </view>

    <!-- Personnel Detail Popup -->
    <view class="detail-popup {{showPersonnelDetail ? 'open' : ''}}" wx:if="{{activeTab === 3}}">
      <view class="detail-mask" bindtap="closePersonnelDetail"></view>
      <view class="detail-content">
        <view class="detail-header">
          <text>äººå‘˜è¯¦æƒ…</text>
          <view class="close-btn" bindtap="closePersonnelDetail">Ã—</view>
        </view>
        <scroll-view scroll-y class="detail-body">
          <view class="detail-title">{{selectedPersonnel.name}} <text style="font-size: 28rpx; color: #666; font-weight: normal;">{{selectedPersonnel.employee_no}}</text></view>
          
          <view class="detail-tags">
             <text wx:if="{{selectedPersonnel.company}}" class="tag tag-primary">{{selectedPersonnel.company}}</text>
             <text wx:if="{{selectedPersonnel.status}}" class="tag tag-secondary">{{selectedPersonnel.status}}</text>
          </view>

          <view class="detail-section">
             <view class="detail-row">
              <text class="label">å·¥å·</text>
              <text class="value">{{selectedPersonnel.employee_no || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">å­¦æ ¡</text>
              <text class="value">{{selectedPersonnel.school || '-'}}</text>
            </view>
            <view class="detail-row">
              <text class="label">å­¦å†</text>
              <text class="value">{{selectedPersonnel.degree || '-'}}</text>
            </view>
             <view class="detail-row">
              <text class="label">ä¸“ä¸š</text>
              <text class="value">{{selectedPersonnel.major || '-'}}</text>
            </view>
          </view>

           <view class="detail-section" wx:if="{{selectedPersonnel.certificates && selectedPersonnel.certificates.length > 0}}">
            <view class="section-title">æŒæœ‰è¯ä¹¦</view>
            <view wx:for="{{selectedPersonnel.certificates}}" wx:key="unique" class="detail-row" style="margin-bottom: 32rpx; border-bottom: 1rpx dashed #eee; padding-bottom: 24rpx;">
                <view style="flex:1;">
                    <view style="font-weight: 600; font-size: 30rpx; margin-bottom: 8rpx;">{{item.certificate_name}}</view>
                    <view style="font-size: 26rpx; color: #666;">
                        <text wx:if="{{item.qualification_level}}" style="margin-right: 16rpx;">{{item.qualification_level}}</text>
                        <text wx:if="{{item.expire_date}}">æœ‰æ•ˆæœŸè‡³: {{item.expire_date}}</text>
                    </view>
                </view>
            </view>
          </view>

        </scroll-view>
        <view class="detail-footer">
          <button class="copy-full-btn" bindtap="copyPersonnelFull" data-item="{{selectedPersonnel}}">å¤åˆ¶å…¨éƒ¨ä¿¡æ¯</button>
        </view>
      </view>
    </view>

    <!-- Load More -->
    <view wx:if="{{hasMore}}" class="load-more">
      <button wx:if="{{!loading}}" class="load-more-btn" bindtap="loadMore">åŠ è½½æ›´å¤š</button>
      <text wx:else>åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- Filter Drawer -->
  <view class="filter-drawer {{showFilter ? 'open' : ''}}">
    <view class="filter-mask" bindtap="closeFilter"></view>
    <view class="filter-content">
      <view class="filter-header">
        <text>ç­›é€‰æ¡ä»¶</text>
        <view class="close-btn" bindtap="closeFilter">Ã—</view>
      </view>
      
      <scroll-view scroll-y class="filter-body">
        <!-- Contract Filters -->
        <block wx:if="{{activeTab === 0}}">
          <view class="filter-group">
            <view class="filter-label">è¡Œä¸š</view>
            <input class="filter-input" placeholder="è¯·è¾“å…¥è¡Œä¸š" data-field="industry" bindinput="onFilterInput" value="{{filters.industry}}" />
          </view>
          <view class="filter-group">
            <view class="filter-label">åˆåŒç±»å‹</view>
            <picker bindchange="bindContractTypeChange" value="{{filters.contractTypeIndex}}" range="{{contractTypeOptions}}">
              <view class="filter-input picker-view">
                {{contractTypeOptions[filters.contractTypeIndex]}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
          <view class="filter-group">
            <view class="filter-label">å®¢æˆ·åç§°</view>
            <input class="filter-input" placeholder="è¯·è¾“å…¥å®¢æˆ·åç§°" data-field="customer" bindinput="onFilterInput" value="{{filters.customer}}" />
          </view>
          <view class="filter-group">
            <view class="filter-label">åˆåŒçŠ¶æ€</view>
            <view class="tag-group">
              <view class="filter-tag {{filters.status === 'å·²å®Œç»“' ? 'active' : ''}}" data-field="status" data-value="å·²å®Œç»“" bindtap="onFilterTag">å·²å®Œç»“</view>
              <view class="filter-tag {{filters.status === 'è¿›è¡Œä¸­' ? 'active' : ''}}" data-field="status" data-value="è¿›è¡Œä¸­" bindtap="onFilterTag">è¿›è¡Œä¸­</view>
            </view>
          </view>
          <view class="filter-group">
            <view class="filter-label">é‡‘é¢èŒƒå›´ (ä¸‡)</view>
            <view class="range-inputs">
              <input class="filter-input small" placeholder="æœ€å°" type="number" data-field="minAmount" bindinput="onFilterInput" value="{{filters.minAmount}}" />
              <text>-</text>
              <input class="filter-input small" placeholder="æœ€å¤§" type="number" data-field="maxAmount" bindinput="onFilterInput" value="{{filters.maxAmount}}" />
            </view>
          </view>
        </block>

        <!-- Personnel Filters -->
        <block wx:if="{{activeTab === 3}}">
          <!-- ... existing personnel filters ... -->
          <view class="filter-group">
            <view class="filter-label">çŠ¶æ€</view>
            <view class="tag-group">
              <view class="filter-tag {{filters.personnelStatus === 'åœ¨èŒ' ? 'active' : ''}}" data-field="personnelStatus" data-value="åœ¨èŒ" bindtap="onFilterTag">åœ¨èŒ</view>
              <view class="filter-tag {{filters.personnelStatus === 'ç¦»èŒ' ? 'active' : ''}}" data-field="personnelStatus" data-value="ç¦»èŒ" bindtap="onFilterTag">ç¦»èŒ</view>
            </view>
          </view>
          <view class="filter-group">
            <view class="filter-label">å…¬å¸</view>
            <input class="filter-input" placeholder="å…¬å¸/ç¤¾ä¿å…¬å¸" data-field="personnelCompany" bindinput="onFilterInput" value="{{filters.personnelCompany}}" />
          </view>
          <view class="filter-group">
            <view class="filter-label">å­¦å†</view>
            <view class="tag-group">
              <view class="filter-tag {{filters.personnelDegree === 'æœ¬ç§‘' ? 'active' : ''}}" data-field="personnelDegree" data-value="æœ¬ç§‘" bindtap="onFilterTag">æœ¬ç§‘</view>
              <view class="filter-tag {{filters.personnelDegree === 'ç¡•å£«' ? 'active' : ''}}" data-field="personnelDegree" data-value="ç¡•å£«" bindtap="onFilterTag">ç¡•å£«</view>
              <view class="filter-tag {{filters.personnelDegree === 'åšå£«' ? 'active' : ''}}" data-field="personnelDegree" data-value="åšå£«" bindtap="onFilterTag">åšå£«</view>
            </view>
          </view>
          <view class="filter-group">
            <view class="filter-label">è¯ä¹¦åç§°</view>
            <input class="filter-input" placeholder="è¯·è¾“å…¥è¯ä¹¦åç§°" data-field="personnelCertificate" bindinput="onFilterInput" value="{{filters.personnelCertificate}}" />
          </view>
        </block>

        <!-- Company Filters -->
        <block wx:if="{{activeTab === 4}}">
          <view class="filter-group">
             <view class="filter-label">ç»è¥çŠ¶æ€</view>
             <view class="tag-group">
               <view class="filter-tag {{filters.status === 'å­˜ç»­' ? 'active' : ''}}" data-field="status" data-value="å­˜ç»­" bindtap="onFilterTag">å­˜ç»­</view>
               <view class="filter-tag {{filters.status === 'åœ¨ä¸š' ? 'active' : ''}}" data-field="status" data-value="åœ¨ä¸š" bindtap="onFilterTag">åœ¨ä¸š</view>
               <view class="filter-tag {{filters.status === 'æ³¨é”€' ? 'active' : ''}}" data-field="status" data-value="æ³¨é”€" bindtap="onFilterTag">æ³¨é”€</view>
             </view>
          </view>
          <view class="filter-group">
            <view class="filter-label">æ³¨å†Œèµ„æœ¬ (ä¸‡)</view>
            <view class="range-inputs">
              <input class="filter-input small" placeholder="æœ€å°" type="number" data-field="capital_min" bindinput="onFilterInput" value="{{filters.capital_min}}" />
              <text>-</text>
              <input class="filter-input small" placeholder="æœ€å¤§" type="number" data-field="capital_max" bindinput="onFilterInput" value="{{filters.capital_max}}" />
            </view>
          </view>
          <view class="filter-group">
            <view class="filter-label">æˆç«‹æ—¶é—´</view>
            <view class="range-inputs">
               <picker mode="date" data-field="start_date" bindchange="bindDateChange">
                 <view class="filter-input small {{filters.start_date ? '' : 'placeholder'}}">
                   {{filters.start_date || 'å¼€å§‹æ—¥æœŸ'}}
                 </view>
               </picker>
               <text>-</text>
               <picker mode="date" data-field="end_date" bindchange="bindDateChange">
                 <view class="filter-input small {{filters.end_date ? '' : 'placeholder'}}">
                   {{filters.end_date || 'ç»“æŸæ—¥æœŸ'}}
                 </view>
               </picker>
            </view>
          </view>
        </block>

        <!-- IP Filters -->
        <block wx:if="{{activeTab === 2}}">
          <view class="filter-group">
            <view class="filter-label">å…¬å¸åç§°</view>
            <input class="filter-input" placeholder="è¯·è¾“å…¥å…¬å¸åç§°" data-field="companyName" bindinput="onFilterInput" value="{{filters.companyName}}" />
          </view>
          <view class="filter-group">
            <view class="filter-label">å…¬å¸ç¼–å·</view>
            <input class="filter-input" placeholder="è¯·è¾“å…¥å…¬å¸ç¼–å·" data-field="companyNumber" bindinput="onFilterInput" value="{{filters.companyNumber}}" />
          </view>
          
          <view class="filter-group">
            <view class="filter-label">çŸ¥è¯†äº§æƒç±»åˆ«</view>
            <picker bindchange="bindIPCategoryChange" value="{{filters.ipCategoryIndex}}" range="{{ipCategoryOptions}}">
              <view class="filter-input picker-view">
                {{ipCategoryOptions[filters.ipCategoryIndex]}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>

          <view class="filter-group">
            <view class="filter-label">å…¬å¸ä¸šåŠ¡ç±»å‹</view>
            <picker bindchange="bindBusinessTypeChange" value="{{filters.businessTypeIndex}}" range="{{businessTypeOptions}}">
              <view class="filter-input picker-view">
                {{businessTypeOptions[filters.businessTypeIndex]}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </block>

        <!-- Empty State for other tabs (Qualifications) -->
        <block wx:if="{{activeTab === 1}}">
           <view class="filter-group">
            <view class="filter-label">å…¬å¸ä¸šåŠ¡ç±»å‹</view>
            <picker bindchange="bindBusinessTypeChange" value="{{filters.businessTypeIndex}}" range="{{businessTypeOptions}}">
              <view class="filter-input picker-view">
                {{businessTypeOptions[filters.businessTypeIndex]}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </block>
      </scroll-view>

      <view class="filter-footer">
        <button class="reset-btn" bindtap="resetFilters">é‡ç½®</button>
        <button class="export-btn" bindtap="exportData" wx:if="{{activeTab === 0}}">å¯¼å‡º</button>
        <button class="apply-btn" bindtap="applyFilters">ç¡®è®¤</button>
      </view>
    </view>
  </view>
</view>
